{% extends "base.html" %}
{% load i18n %}
{% block content %}
<div class="leftpanel">
<h1>{{title}}</h1>
{% if test_name %}
<h2>{% trans "Executed test:" %} {{test_name}}</h2>
{% endif %}

<h2>{% trans "Run now!"%}</h2>
<form method="post">
<input type="hidden" name="test" value="1">
<input type="submit" name="run" value="Run">
</form>
</div>

<div class="centralpanel">

<a id="reload" href="javascript:reload_results()">{% trans "Reload" %}</a>

<h2>{% trans "Latest executions" %}</h2>

<ul id="results">
</ul>

</div>

<script>
var okicon=$("<span class='icon'>ðŸ˜Ž</span>");
var runningicon=$("<span class='icon'>â™¨</span>");
var erroricon=$("<span class='icon'>â›ˆ</span>");

reload_results = function(){
	var pollingd=false;
	$.get('/results', function(data){
		do_poll=false;
		var ul=$('#results')
		ul.html('')
		var lis=[]
		for (var k in data){
			var li=$('<li>')

			var a=$('<a>').attr('href','/result/'+k)

			if (data[k].result==0)
				a.append(okicon.clone()).addClass("ok");
			else if (data[k].running){
				a.append(runningicon.clone()).addClass("running");
				do_poll=true;
			}
			else
				a.append(erroricon.clone()).addClass("error");

			a.append(data[k].name)
			a.append('<br/>' + (new Date(Number(data[k].timestamp)*1000)) + '<br>Result: ' + data[k].result)
			
			li.append(a)
			
			li.attr('timestamp',data[k].timestamp)
			
			lis.push(li)
		}
		
		lis=lis.sort(function(a,b){ 
			return a.attr('timestamp') < b.attr('timestamp') ? 1 : -1
			})
		ul.append(lis)
		
		if (do_poll && !pollingd)
			pollingd=setTimeout(reload_results, 1000);
		if (!do_poll && pollingd){
			clearInterval(pollingd)
			pollingd=false;
		}
	},'json')
}

$(document).ready(function(){
	reload_results();
	$('#reload').focus()
})
</script>

{% endblock %}
